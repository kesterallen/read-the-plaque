
<!-- Map stuff -->
<style>
#map {
    height: 400px;
}
</style>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCPGpsCWGQww0hOPhblgBu34eoVnzf5sKo"></script>
<script>
    function initialize() {
        var mapCanvas = document.getElementById('map');

        var mapOptions = {
            center: {
                lat: {{plaques[0].location.lat}},
                lng: {{plaques[0].location.lon}}
            },
            zoom: {{mapzoom}},
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        var map = new google.maps.Map(mapCanvas, mapOptions)

//        // TODO: replace the  for loop with this:
//        var infoForMarkers = [
//             {% for plaque in plaques %}
//                { lat: {{plaque.location.lat}},
//                  lng: {{plaque.location.lon}},
//                  title: {{plaque.title}},
//                  url: "/plaque/{{plaque.key.urlsafe()}}"
//                },
//             {% endfor %}
//        ];
//        var i;
//        for (i = 0; i < infoForMarkers.length; ++i) {
//            var marker = new google.maps.Marker({
//                                 position: {lat: infoForMarkers[i].lat,
//                                            lng: infoForMarkers[i].lng},
//                                 map: map,
//                                 title: infoForMarkers[i].title,
//                                 url: infoForMarkers[i].url,
//            });
//            var infowindow = new google.maps.InfoWindow({content: infoForMarkers[i].title});
//            google.maps.event.addListener(marker, 'mouseover', function() {
//                infowindow.open(map, this);
//            });
//        }

        {% for plaque in plaques %}
            var marker = new google.maps.Marker({
                                 position: {lat: {{plaque.location.lat}},
                                            lng: {{plaque.location.lon}}},
                                 map: map,
                                 title: "{{plaque.title}}",
                                 url: "/plaque/{{plaque.key.urlsafe()}}"
                         });

            google.maps.event.addListener(marker, 'click', function() {
                window.location.href = this.url;
            });
        {% endfor %}
    }
    google.maps.event.addDomListener(window, 'load', initialize);
</script>
<!-- End map stuff -->

