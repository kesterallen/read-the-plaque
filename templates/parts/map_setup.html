
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCPGpsCWGQww0hOPhblgBu34eoVnzf5sKo"></script>
<script>
    function initialize() {
        var mapCanvas = document.getElementById('map');

        var mapOptions = {
            center: {
                {% if all_plaques|length == 1 %}
                    lat: {{all_plaques[0].location.lat}},
                    lng: {{all_plaques[0].location.lon}}
                {% else %}
                    lat: 0,
                    lng: -20,
                {% endif %}
            },
            zoom: {{mapzoom}},
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        var map = new google.maps.Map(mapCanvas, mapOptions)

        var infoForMarkers = [
            {% for plaque in all_plaques %}
                { lat: {{plaque.location.lat}},
                  lng: {{plaque.location.lon}},
                  title: "{{plaque.title|escape}}",
                  content: "<a href='/plaque/{{plaque.key.urlsafe()}}'><h3>{{plaque.title|escape}}</h3> <p> <img src='{{plaque.thumbnail_url}}'/></a>",
                  url: "/plaque/{{plaque.key.urlsafe()}}"
                },
            {% endfor %}
        ];
        var i;
        var k;
        var infoWindows = [];
        var markers = [];

        for (i = 0; i < infoForMarkers.length; ++i) {
            markers.push(new google.maps.Marker({
                position: {lat: infoForMarkers[i].lat,
                           lng: infoForMarkers[i].lng},
                map: map,
                url: infoForMarkers[i].url,
            }));

            infoWindows.push(new google.maps.InfoWindow({
                content: infoForMarkers[i].content
            }));
            google.maps.event.addListener(markers[i], 'click', /*'mouseover'*/ function(j) {
                return function() {
                    for (k = 0; k < infoForMarkers.length; ++k) {
                        infoWindows[k].close();
                    }
                    infoWindows[j].open(map, markers[j]);
                }
            }(i));
            //google.maps.event.addListener(markers[i], 'mouseout', function(j) {
                //return function() {
                    //infoWindows[j].close();
                //}
            //}(i));
            //google.maps.event.addListener(markers[i], 'click', function(j) {
                //return function() {
                    //window.location.href = this.url;
                //}
            //}(i));
        }
    }
    google.maps.event.addDomListener(window, 'load', initialize);
</script>

