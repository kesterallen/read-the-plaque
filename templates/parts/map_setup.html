
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCPGpsCWGQww0hOPhblgBu34eoVnzf5sKo"></script>
<script>
    function initialize() {
        var mapCanvas = document.getElementById('map');

        var mapOptions = {
            center: {
                {% if all_plaques|length == 1 %}
                    lat: {{all_plaques[0].location.lat}},
                    lng: {{all_plaques[0].location.lon}}
                {% else %}
                    lat: 0,
                    lng: 0,
                {% endif %}
            },
            zoom: {{mapzoom}},
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        var map = new google.maps.Map(mapCanvas, mapOptions)

        var infoForMarkers = [
            {% for plaque in all_plaques %}
                { lat: {{plaque.location.lat}},
                  lng: {{plaque.location.lon}},
                  title: "{{plaque.title}}",
                  url: "/plaque/{{plaque.key.urlsafe()}}"
                },
            {% endfor %}
        ];
        var i;
        var infowindows = [];
        var markers = [];

        for (i = 0; i < infoForMarkers.length; ++i) {
            var marker = new google.maps.Marker({
                                 position: {lat: infoForMarkers[i].lat,
                                            lng: infoForMarkers[i].lng},
                                 map: map,
                                 title: infoForMarkers[i].title,
                                 url: infoForMarkers[i].url,
            });
            markers.push(marker);
            //
            // InfoWindow stuff:
            //
            var infowindow = new google.maps.InfoWindow({content: infoForMarkers[i].title});
            infowindows.push(infowindow);
        }

        for (i = 0; i < infoForMarkers.length; ++i) {
            google.maps.event.addListener(markers[i], 'mouseover', function() {
                infowindows[i].open(map, this);
            });
            google.maps.event.addListener(markers[i], 'mouseout', function() {
                infowindows[i].close();
            });
            google.maps.event.addListener(markers[i], 'click', function() {
                window.location.href = this.url;
            });
        }
    }
    google.maps.event.addDomListener(window, 'load', initialize);
</script>

