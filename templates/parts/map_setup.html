
<script src="https://maps.google.com/maps/api/js?sensor=false"></script>
<script>
    function initialize() {
        var mapCanvas = document.getElementById('map');

        var mapOptions = {
            center: {
                {% if mapcenter %}
                    lat: {{mapcenter['lat']}},
                    lng: {{mapcenter['lng']}}
                {% else %}
                    {% if all_plaques|length == 1 %}
                        lat: {{all_plaques[0].location.lat}},
                        lng: {{all_plaques[0].location.lon}}
                    {% else %}
                        lat: 15,
                        lng: -25,
                    {% endif %}
                {% endif %}
            },
            zoom: {{mapzoom}},
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        var icon = {
            url: "/images/red-dot.png",
            scaledSize: new google.maps.Size({{icon_size}}, {{icon_size}}),
            origin: new google.maps.Point(0, 0), // origin -- top left
            anchor: new google.maps.Point({{icon_size / 2}}, {{icon_size}}) // anchor -- bottom middle
        };
        var map = new google.maps.Map(mapCanvas, mapOptions)

        var markers = [];

        {% for plaque in all_plaques %}
            markers.push(new google.maps.Marker({
                map: map,
                icon: icon,
                position: {lat: {{plaque.location.lat}},
                           lng: {{plaque.location.lon}}},
                url: "{{plaque.title_page_url}}",
                infowindow: new google.maps.InfoWindow({
                    content: "{{plaque.title|escape}}<p>" + 
                             "<img src='{{plaque.img_url_tiny}}'/>"
                })
            }));

            google.maps.event.addListener(markers[{{loop.index0}}], 'mouseover', function(j) {
                return function() { markers[j].infowindow.open(map, markers[j]); }
            }({{loop.index0}}));
            google.maps.event.addListener(markers[{{loop.index0}}], 'mouseout', function(j) {
                return function() { markers[j].infowindow.close(); }
            }({{loop.index0}}));
            google.maps.event.addListener(markers[{{loop.index0}}], 'click', function(j) {
                return function() { window.location.href = this.url; }
            }({{loop.index0}}));
        {% endfor %}
    }
    google.maps.event.addDomListener(window, 'load', initialize);
</script>

